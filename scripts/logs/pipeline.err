+ echo -e '\n================================================= ARGUMENT PARSING & VALIDATION =================================================\n'
+ TRIM=false
+ REMOVE_HOST_DNA=false
+ GROUND_TRUTH=false
+ [[ 3 -gt 0 ]]
+ case "$1" in
+ [[ -z ../zymobiomics_folder/raw_data/ ]]
+ [[ ../zymobiomics_folder/raw_data/ == -* ]]
+ [[ ! -d ../zymobiomics_folder/raw_data/ ]]
++ find ../zymobiomics_folder/raw_data/ -maxdepth 1 -type f '(' -name '*.fq' -o -name '*.fastq' -o -name '*.fq.gz' -o -name '*.fastq.gz' ')'
+ [[ -z ../zymobiomics_folder/raw_data/ZC2_S5_L001_R1_001.fastq.gz
../zymobiomics_folder/raw_data/ZC3_S6_L001_R2_001.fastq.gz
../zymobiomics_folder/raw_data/ZC1_S4_L001_R1_001.fastq.gz
../zymobiomics_folder/raw_data/ZP2_S21_L001_R2_001.fastq.gz
../zymobiomics_folder/raw_data/ZC2_S5_L001_R2_001.fastq.gz
../zymobiomics_folder/raw_data/ZC1_S4_L001_R2_001.fastq.gz
../zymobiomics_folder/raw_data/ZC4_S7_L001_R1_001.fastq.gz
../zymobiomics_folder/raw_data/ZP1_S20_L001_R2_001.fastq.gz
../zymobiomics_folder/raw_data/ZP3_S22_L001_R1_001.fastq.gz
../zymobiomics_folder/raw_data/ZP1_S20_L001_R1_001.fastq.gz
../zymobiomics_folder/raw_data/ZC4_S7_L001_R2_001.fastq.gz
../zymobiomics_folder/raw_data/ZP2_S21_L001_R1_001.fastq.gz
../zymobiomics_folder/raw_data/ZP3_S22_L001_R2_001.fastq.gz
../zymobiomics_folder/raw_data/ZC3_S6_L001_R1_001.fastq.gz ]]
+ for file in "$2"/*.{fq,fastq}
+ [[ -f ../zymobiomics_folder/raw_data//*.fq ]]
+ for file in "$2"/*.{fq,fastq}
+ [[ -f ../zymobiomics_folder/raw_data//*.fastq ]]
+ for file in "$2"/*.fq.gz
+ [[ -f ../zymobiomics_folder/raw_data//*.fq.gz ]]
+ RAW_FASTQ_DIR=../zymobiomics_folder/raw_data/
+ echo 'Raw FASTQ directory path: ../zymobiomics_folder/raw_data/'
++ dirname ../zymobiomics_folder/raw_data/
+ PROJ_DIR=../zymobiomics_folder
++ dirname ../zymobiomics_folder
+ ROOT_DIR=..
+ DATABASE=../data/databases/k2_standard_16gb_20241228
+ BOWTIE_PREFIX=../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as
+ shift 2
+ [[ 1 -gt 0 ]]
+ case "$1" in
+ [[ -z '' ]]
+ echo '⚠️ Warning: No argument provided. Using default: ../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as'
+ shift
+ REMOVE_HOST_DNA=true
+ [[ 0 -gt 0 ]]
+ [[ -z ../zymobiomics_folder/raw_data/ ]]
+ echo -e '\nPIPELINE SUMMARY: '
++ [[ false == true ]]
++ echo 'Disabled ❌'
+ echo -e 'Quality Control & Trimming: Disabled ❌'
+ echo '⚠️ Optional, but must be done at least once on the raw reads for the pipeline to work.'
+ echo ''
+ [[ true == true ]]
+ echo -e 'Host DNA Removal: Enabled ✅'
+ echo 'Bowtie2 Index Prefix: ../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as'
+ echo '⚠️ Optional, but must be done at least once on the trimmed reads for the pipeline to work.'
+ echo ''
+ echo 'Kraken2/Bracken Database: ../data/databases/k2_standard_16gb_20241228'
+ echo -e '\n================================================= CONDA ENVIRONMENT ACTIVATION ==================================================\n'
+ ../scripts/helper_scripts/environment_setup.sh ../scripts/final_project.yml
+ echo -e '\n====================================================== PROJECT STRUCTURE ======================================================\n'
+ RESULTS_DIR=../zymobiomics_folder/results
+ FASTQC_DIR=../zymobiomics_folder/results/fastqc
+ HOST_DNA_ANALYSIS_DIR=../zymobiomics_folder/results/host_dna_analysis
++ dirname ../zymobiomics_folder/raw_data/
+ PROCESSED_DIR=../zymobiomics_folder/processed_data
+ TRIMMED_DIR=../zymobiomics_folder/processed_data/trimmed
+ HUMAN_DIR=../zymobiomics_folder/processed_data/human
+ ALIGNED_SAM_DIR=../zymobiomics_folder/processed_data/human/aligned_sam
+ SORTED_BAM_DIR=../zymobiomics_folder/processed_data/human/sorted_bam
+ BED_FILES_DIR=../zymobiomics_folder/processed_data/human/bed_files
+ METAGENOMIC_DIR=../zymobiomics_folder/processed_data/metagenomic
+ FILTERED_FASTQ_DIR=../zymobiomics_folder/processed_data/metagenomic/filtered_fastq
+ KRAKEN2_DIR=../zymobiomics_folder/processed_data/metagenomic/kraken2
+ CLASSIFIED_DIR=../zymobiomics_folder/processed_data/metagenomic/classified
+ UNCLASSIFIED_DIR=../zymobiomics_folder/processed_data/metagenomic/unclassified
+ BRACKEN_DIR=../zymobiomics_folder/processed_data/metagenomic/bracken
++ date +run_%d%m_%H%M
+ RUN_DIR=../zymobiomics_folder/results/runs/run_0604_1809
+ REPORTS_DIR=../zymobiomics_folder/results/runs/run_0604_1809/reports
+ KRONA_DIR=../zymobiomics_folder/results/runs/run_0604_1809/krona
+ DIVERSITY_DIR=../zymobiomics_folder/results/runs/run_0604_1809/diversity
+ mkdir -p ../zymobiomics_folder/results ../zymobiomics_folder/results/host_dna_analysis ../zymobiomics_folder/results/fastqc/pre_trimming ../zymobiomics_folder/results/fastqc/post_trimming ../zymobiomics_folder/processed_data/trimmed/paired ../zymobiomics_folder/processed_data/trimmed/unpaired ../zymobiomics_folder/processed_data/human/aligned_sam ../zymobiomics_folder/processed_data/metagenomic/filtered_fastq ../zymobiomics_folder/processed_data/metagenomic/kraken2 ../zymobiomics_folder/processed_data/metagenomic/classified ../zymobiomics_folder/processed_data/metagenomic/unclassified ../zymobiomics_folder/processed_data/metagenomic/bracken ../zymobiomics_folder/results/runs/run_0604_1809/reports ../zymobiomics_folder/results/runs/run_0604_1809/krona ../zymobiomics_folder/results/runs/run_0604_1809/diversity ../zymobiomics_folder/processed_data/human/sorted_bam ../zymobiomics_folder/processed_data/human/bed_files
+ tree -L 3 -d ../zymobiomics_folder
+ echo 'Human DNA-related files (SAM, BAM, and BED) in the '\''human'\'' directory are created once per sub-project and remain unchanged across runs.'
+ echo 'Intermediate metagenomic files in the '\''metagenomic'\'' directory are overwritten with each run and should be inspected beforehand if desired.'
+ echo 'Results are stored in the '\''results'\'' directory (including FastQC, host DNA analysis, and run-specific results like Kraken2 and Bracken).'
+ [[ false == true ]]
+ echo -e '\n================================================= METAGENOMIC ABUNDANCE ESTIMATION ================================================='
+ echo '⚠️ This step assumes reads have already been trimmed with Trimmomatic and host DNA removed with Bowtie2. Processed reads must be in the correct directory.'
++ date +%s
+ START_TIME=1743959391
+ for R1 in "$TRIMMED_DIR"/paired/*_R1_paired.fastq.gz
++ basename ../zymobiomics_folder/processed_data/trimmed/paired/ZC1_S4_R1_paired.fastq.gz _R1_paired.fastq.gz
+ base=ZC1_S4
+ echo -e '\nProcessing sample: ZC1_S4'
+ [[ true == true ]]
+ echo -e '\nRemoving human reads with Bowtie2...'
+ bowtie2 -x ../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as -p 8 -q --end-to-end --very-sensitive --no-mixed --no-discordant -1 ../zymobiomics_folder/processed_data/trimmed/paired/ZC1_S4_R1_paired.fastq.gz -2 ../zymobiomics_folder/processed_data/trimmed/paired/ZC1_S4_R2_paired.fastq.gz --un-conc ../zymobiomics_folder/processed_data/metagenomic/filtered_fastq/ZC1_S4_metagenomic -S ../zymobiomics_folder/processed_data/human/aligned_sam/ZC1_S4_human.sam
