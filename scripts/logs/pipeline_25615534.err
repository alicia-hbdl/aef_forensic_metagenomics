+ echo -e '\n================================================= ARGUMENT PARSING & VALIDATION =================================================\n'
+ TRIM=false
+ REMOVE_HOST_DNA=false
+ GROUND_TRUTH=true
+ [[ 4 -gt 0 ]]
+ case "$1" in
+ [[ -z ../casework_folder/raw_data/ ]]
+ [[ ../casework_folder/raw_data/ == -* ]]
+ [[ ! -d ../casework_folder/raw_data/ ]]
++ find ../casework_folder/raw_data/ -maxdepth 1 -type f '(' -name '*.fq' -o -name '*.fastq' -o -name '*.fq.gz' -o -name '*.fastq.gz' ')'
+ [[ -z ../casework_folder/raw_data/Heart_S16_L001_R1_001.fastq.gz
../casework_folder/raw_data/Heart_S16_L001_R2_001.fastq.gz ]]
+ for file in "$2"/*.{fq,fastq}
+ [[ -f ../casework_folder/raw_data//*.fq ]]
+ for file in "$2"/*.{fq,fastq}
+ [[ -f ../casework_folder/raw_data//*.fastq ]]
+ for file in "$2"/*.fq.gz
+ [[ -f ../casework_folder/raw_data//*.fq.gz ]]
+ RAW_FASTQ_DIR=../casework_folder/raw_data/
+ echo 'Raw FASTQ directory path: ../casework_folder/raw_data/'
++ dirname ../casework_folder/raw_data/
+ PROJ_DIR=../casework_folder
++ dirname ../casework_folder
+ ROOT_DIR=..
+ DATABASE=../data/databases/k2_standard_16gb_20241228
+ BOWTIE_PREFIX=../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as
+ shift 2
+ [[ 2 -gt 0 ]]
+ case "$1" in
+ [[ -z -t ]]
+ [[ -t == -* ]]
+ echo '⚠️ Warning: No argument provided. Using default: ../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as'
+ shift
+ REMOVE_HOST_DNA=true
+ [[ 1 -gt 0 ]]
+ case "$1" in
+ TRIM=true
+ echo '✅ Trimming enabled.'
+ shift
+ [[ 0 -gt 0 ]]
+ [[ -z ../casework_folder/raw_data/ ]]
++ [[ true == true ]]
++ echo 'Enabled ✅'
+ echo -e 'Quality Control & Trimming: Enabled ✅'
+ echo '⚠️ Optional, but must be done at least once on the raw reads for the pipeline to work.'
+ echo ''
+ [[ true == true ]]
+ echo -e 'Host DNA Removal: Enabled ✅'
+ echo 'Bowtie2 Index Prefix: ../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as'
+ echo '⚠️ Optional, but must be done at least once on the trimmed reads for the pipeline to work.'
+ echo ''
+ echo 'Kraken2/Bracken Database: ../data/databases/k2_standard_16gb_20241228'
+ echo -e '\n================================================= CONDA ENVIRONMENT ACTIVATION ==================================================\n'
+ source ../scripts/helper_scripts/environment_setup.sh ../scripts/metagenomics.yml
++ [[ -z ../scripts/metagenomics.yml ]]
++ [[ ../scripts/metagenomics.yml != *.yml ]]
++ [[ ! -f ../scripts/metagenomics.yml ]]
++ ENV_FILE=../scripts/metagenomics.yml
+++ basename ../scripts/metagenomics.yml .yml
++ ENV_NAME=metagenomics
++ command -v conda
+++ conda shell.bash hook
++ eval 'export CONDA_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python'\''

# Copyright (C) 2012 Anaconda, Inc
# SPDX-License-Identifier: BSD-3-Clause

__conda_exe() (
    "$CONDA_EXE" $_CE_M $_CE_CONDA "$@"
)

__conda_hashr() {
    if [ -n "${ZSH_VERSION:+x}" ]; then
        \rehash
    elif [ -n "${POSH_VERSION:+x}" ]; then
        :  # pass
    else
        \hash -r
    fi
}

__conda_activate() {
    if [ -n "${CONDA_PS1_BACKUP:+x}" ]; then
        # Handle transition from shell activated with conda <= 4.3 to a subsequent activation
        # after conda updated to >= 4.4. See issue #6173.
        PS1="$CONDA_PS1_BACKUP"
        \unset CONDA_PS1_BACKUP
    fi
    \local ask_conda
    ask_conda="$(PS1="${PS1:-}" __conda_exe shell.posix "$@")" || \return
    \eval "$ask_conda"
    __conda_hashr
}

__conda_reactivate() {
    \local ask_conda
    ask_conda="$(PS1="${PS1:-}" __conda_exe shell.posix reactivate)" || \return
    \eval "$ask_conda"
    __conda_hashr
}

conda() {
    \local cmd="${1-__missing__}"
    case "$cmd" in
        activate|deactivate)
            __conda_activate "$@"
            ;;
        install|update|upgrade|remove|uninstall)
            __conda_exe "$@" || \return
            __conda_reactivate
            ;;
        *)
            __conda_exe "$@"
            ;;
    esac
}

if [ -z "${CONDA_SHLVL+x}" ]; then
    \export CONDA_SHLVL=0
    # In dev-mode CONDA_EXE is python.exe and on Windows
    # it is in a different relative location to condabin.
    if [ -n "${_CE_CONDA:+x}" ] && [ -n "${WINDIR+x}" ]; then
        PATH="$(\dirname "$CONDA_EXE")/condabin${PATH:+":${PATH}"}"
    else
        PATH="$(\dirname "$(\dirname "$CONDA_EXE")")/condabin${PATH:+":${PATH}"}"
    fi
    \export PATH

    # We'\''re not allowing PS1 to be unbound. It must at least be set.
    # However, we'\''re not exporting it, which can cause problems when starting a second shell
    # via a first shell (i.e. starting zsh from bash).
    if [ -z "${PS1+x}" ]; then
        PS1=
    fi
fi

conda activate base'
+++ export CONDA_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda
+++ CONDA_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python
+++ CONDA_PYTHON_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python
+++ '[' -z x ']'
+++ conda activate base
+++ local cmd=activate
+++ case "$cmd" in
+++ __conda_activate activate base
+++ '[' -n '' ']'
+++ local ask_conda
++++ PS1=
++++ __conda_exe shell.posix activate base
++++ /software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda shell.posix activate base
+++ ask_conda='. "/users/k24087895/.conda/envs/metagenomics/etc/conda/deactivate.d/openjdk_deactivate.sh"
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/deactivate.d/libglib_deactivate.sh"
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/deactivate.d/deactivate-r-base.sh"
PS1='\''(base) '\''
export PATH='\''/users/k24087895/.local/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin'\''
export CONDA_PREFIX='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe'\''
export CONDA_SHLVL='\''5'\''
export CONDA_DEFAULT_ENV='\''base'\''
export CONDA_PROMPT_MODIFIER='\''(base) '\''
export CONDA_PREFIX_4='\''/users/k24087895/.conda/envs/metagenomics'\''
export CONDA_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python'\'''
+++ eval '. "/users/k24087895/.conda/envs/metagenomics/etc/conda/deactivate.d/openjdk_deactivate.sh"
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/deactivate.d/libglib_deactivate.sh"
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/deactivate.d/deactivate-r-base.sh"
PS1='\''(base) '\''
export PATH='\''/users/k24087895/.local/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin'\''
export CONDA_PREFIX='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe'\''
export CONDA_SHLVL='\''5'\''
export CONDA_DEFAULT_ENV='\''base'\''
export CONDA_PROMPT_MODIFIER='\''(base) '\''
export CONDA_PREFIX_4='\''/users/k24087895/.conda/envs/metagenomics'\''
export CONDA_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python'\'''
++++ . /users/k24087895/.conda/envs/metagenomics/etc/conda/deactivate.d/openjdk_deactivate.sh
+++++ '[' x ']'
+++++ export JAVA_HOME=/users/k24087895/.conda/envs/metagenomics/lib/jvm
+++++ JAVA_HOME=/users/k24087895/.conda/envs/metagenomics/lib/jvm
+++++ unset JAVA_HOME_CONDA_BACKUP
+++++ '[' x ']'
+++++ export JAVA_LD_LIBRARY_PATH=/users/k24087895/.conda/envs/metagenomics/lib/jvm/lib/server
+++++ JAVA_LD_LIBRARY_PATH=/users/k24087895/.conda/envs/metagenomics/lib/jvm/lib/server
+++++ unset JAVA_LD_LIBRARY_PATH_BACKUP
++++ . /users/k24087895/.conda/envs/metagenomics/etc/conda/deactivate.d/libglib_deactivate.sh
+++++ export GSETTINGS_SCHEMA_DIR=
+++++ GSETTINGS_SCHEMA_DIR=
+++++ unset GSETTINGS_SCHEMA_DIR_CONDA_BACKUP
+++++ '[' -z ']'
+++++ unset GSETTINGS_SCHEMA_DIR
++++ . /users/k24087895/.conda/envs/metagenomics/etc/conda/deactivate.d/deactivate-r-base.sh
+++++ '[' -n '' ']'
+++++ unset RSTUDIO_WHICH_R
++++ PS1='(base) '
++++ export PATH=/users/k24087895/.local/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin
++++ PATH=/users/k24087895/.local/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin
++++ export CONDA_PREFIX=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe
++++ CONDA_PREFIX=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe
++++ export CONDA_SHLVL=5
++++ CONDA_SHLVL=5
++++ export CONDA_DEFAULT_ENV=base
++++ CONDA_DEFAULT_ENV=base
++++ export 'CONDA_PROMPT_MODIFIER=(base) '
++++ CONDA_PROMPT_MODIFIER='(base) '
++++ export CONDA_PREFIX_4=/users/k24087895/.conda/envs/metagenomics
++++ CONDA_PREFIX_4=/users/k24087895/.conda/envs/metagenomics
++++ export CONDA_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda
++++ CONDA_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda
++++ export _CE_M=
++++ _CE_M=
++++ export _CE_CONDA=
++++ _CE_CONDA=
++++ export CONDA_PYTHON_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python
++++ CONDA_PYTHON_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python
+++ __conda_hashr
+++ '[' -n '' ']'
+++ '[' -n '' ']'
+++ hash -r
++ conda env list
++ local cmd=env
++ case "$cmd" in
++ __conda_exe env list
++ grep -q metagenomics
++ /software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda env list
++ conda activate metagenomics
++ local cmd=activate
++ case "$cmd" in
++ __conda_activate activate metagenomics
++ '[' -n '' ']'
++ local ask_conda
+++ PS1='(base) '
+++ __conda_exe shell.posix activate metagenomics
+++ /software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda shell.posix activate metagenomics
++ ask_conda='PS1='\''(metagenomics) '\''
export PATH='\''/users/k24087895/.local/bin:/users/k24087895/.conda/envs/metagenomics/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin'\''
export CONDA_PREFIX='\''/users/k24087895/.conda/envs/metagenomics'\''
export CONDA_SHLVL='\''6'\''
export CONDA_DEFAULT_ENV='\''metagenomics'\''
export CONDA_PROMPT_MODIFIER='\''(metagenomics) '\''
export CONDA_PREFIX_5='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe'\''
export CONDA_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python'\''
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/activate.d/activate-r-base.sh"
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/activate.d/libglib_activate.sh"
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/activate.d/openjdk_activate.sh"'
++ eval 'PS1='\''(metagenomics) '\''
export PATH='\''/users/k24087895/.local/bin:/users/k24087895/.conda/envs/metagenomics/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin'\''
export CONDA_PREFIX='\''/users/k24087895/.conda/envs/metagenomics'\''
export CONDA_SHLVL='\''6'\''
export CONDA_DEFAULT_ENV='\''metagenomics'\''
export CONDA_PROMPT_MODIFIER='\''(metagenomics) '\''
export CONDA_PREFIX_5='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe'\''
export CONDA_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda'\''
export _CE_M='\'''\''
export _CE_CONDA='\'''\''
export CONDA_PYTHON_EXE='\''/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python'\''
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/activate.d/activate-r-base.sh"
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/activate.d/libglib_activate.sh"
. "/users/k24087895/.conda/envs/metagenomics/etc/conda/activate.d/openjdk_activate.sh"'
+++ PS1='(metagenomics) '
+++ export PATH=/users/k24087895/.local/bin:/users/k24087895/.conda/envs/metagenomics/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin
+++ PATH=/users/k24087895/.local/bin:/users/k24087895/.conda/envs/metagenomics/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin
+++ export CONDA_PREFIX=/users/k24087895/.conda/envs/metagenomics
+++ CONDA_PREFIX=/users/k24087895/.conda/envs/metagenomics
+++ export CONDA_SHLVL=6
+++ CONDA_SHLVL=6
+++ export CONDA_DEFAULT_ENV=metagenomics
+++ CONDA_DEFAULT_ENV=metagenomics
+++ export 'CONDA_PROMPT_MODIFIER=(metagenomics) '
+++ CONDA_PROMPT_MODIFIER='(metagenomics) '
+++ export CONDA_PREFIX_5=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe
+++ CONDA_PREFIX_5=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe
+++ export CONDA_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda
+++ CONDA_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python
+++ CONDA_PYTHON_EXE=/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/bin/python
+++ . /users/k24087895/.conda/envs/metagenomics/etc/conda/activate.d/activate-r-base.sh
++++ R CMD javareconf
++++ '[' -n '' ']'
++++ export RSTUDIO_WHICH_R=/users/k24087895/.conda/envs/metagenomics/bin/R
++++ RSTUDIO_WHICH_R=/users/k24087895/.conda/envs/metagenomics/bin/R
+++ . /users/k24087895/.conda/envs/metagenomics/etc/conda/activate.d/libglib_activate.sh
++++ export GSETTINGS_SCHEMA_DIR_CONDA_BACKUP=
++++ GSETTINGS_SCHEMA_DIR_CONDA_BACKUP=
++++ export GSETTINGS_SCHEMA_DIR=/users/k24087895/.conda/envs/metagenomics/share/glib-2.0/schemas
++++ GSETTINGS_SCHEMA_DIR=/users/k24087895/.conda/envs/metagenomics/share/glib-2.0/schemas
+++ . /users/k24087895/.conda/envs/metagenomics/etc/conda/activate.d/openjdk_activate.sh
++++ '[' x ']'
++++ export JAVA_HOME_CONDA_BACKUP=/users/k24087895/.conda/envs/metagenomics/lib/jvm
++++ JAVA_HOME_CONDA_BACKUP=/users/k24087895/.conda/envs/metagenomics/lib/jvm
++++ export JAVA_HOME=/users/k24087895/.conda/envs/metagenomics/lib/jvm
++++ JAVA_HOME=/users/k24087895/.conda/envs/metagenomics/lib/jvm
++++ '[' x ']'
++++ export JAVA_LD_LIBRARY_PATH_BACKUP=/users/k24087895/.conda/envs/metagenomics/lib/jvm/lib/server
++++ JAVA_LD_LIBRARY_PATH_BACKUP=/users/k24087895/.conda/envs/metagenomics/lib/jvm/lib/server
++++ export JAVA_LD_LIBRARY_PATH=/users/k24087895/.conda/envs/metagenomics/lib/jvm/lib/server
++++ JAVA_LD_LIBRARY_PATH=/users/k24087895/.conda/envs/metagenomics/lib/jvm/lib/server
++ __conda_hashr
++ '[' -n '' ']'
++ '[' -n '' ']'
++ hash -r
++ echo '✅ '\''metagenomics'\'' environment activated successfully.'
++ export PATH=/users/k24087895/.conda/envs/metagenomics/bin:/users/k24087895/.local/bin:/users/k24087895/.conda/envs/metagenomics/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin
++ PATH=/users/k24087895/.conda/envs/metagenomics/bin:/users/k24087895/.local/bin:/users/k24087895/.conda/envs/metagenomics/bin:/software/spackages_v0_21_prod/apps/linux-ubuntu22.04-zen2/gcc-13.2.0/anaconda3-2022.10-5wy43yh5crcsmws4afls5thwoskzarhe/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/opt/puppetlabs/bin
+++ python -c 'import sys; print(".".join(map(str, sys.version_info[:3])))'
++ export PYTHONPATH=/users/k24087895/.conda/envs/metagenomics/lib/python3.12.10/site-packages:
++ PYTHONPATH=/users/k24087895/.conda/envs/metagenomics/lib/python3.12.10/site-packages:
+ echo -e '\n====================================================== PROJECT STRUCTURE ======================================================\n'
+ RESULTS_DIR=../casework_folder/results
+ FASTQC_DIR=../casework_folder/results/fastqc
+ HOST_DNA_ANALYSIS_DIR=../casework_folder/results/host_dna_analysis
++ dirname ../casework_folder/raw_data/
+ PROCESSED_DIR=../casework_folder/processed_data
+ TRIMMED_DIR=../casework_folder/processed_data/trimmed
+ HUMAN_DIR=../casework_folder/processed_data/human
+ ALIGNED_SAM_DIR=../casework_folder/processed_data/human/aligned_sam
+ SORTED_BAM_DIR=../casework_folder/processed_data/human/sorted_bam
+ BED_FILES_DIR=../casework_folder/processed_data/human/bed_files
+ METAGENOMIC_DIR=../casework_folder/processed_data/metagenomic
+ FILTERED_FASTQ_DIR=../casework_folder/processed_data/metagenomic/filtered_fastq
+ KRAKEN2_DIR=../casework_folder/processed_data/metagenomic/kraken2
+ CLASSIFIED_DIR=../casework_folder/processed_data/metagenomic/classified
+ UNCLASSIFIED_DIR=../casework_folder/processed_data/metagenomic/unclassified
+ BRACKEN_DIR=../casework_folder/processed_data/metagenomic/bracken
++ date +run_%d%m_%H%M
+ RUN_DIR=../casework_folder/results/runs/run_3004_1602
+ REPORTS_DIR=../casework_folder/results/runs/run_3004_1602/reports
+ KRONA_DIR=../casework_folder/results/runs/run_3004_1602/krona
+ DIVERSITY_DIR=../casework_folder/results/runs/run_3004_1602/diversity
+ LOG_DIR=../casework_folder/results/runs/run_3004_1602/logs
+ mkdir -p ../casework_folder/results ../casework_folder/results/host_dna_analysis ../casework_folder/results/fastqc/pre_trimming ../casework_folder/results/fastqc/post_trimming ../casework_folder/processed_data/trimmed/paired ../casework_folder/processed_data/trimmed/unpaired ../casework_folder/processed_data/human/aligned_sam ../casework_folder/processed_data/metagenomic/filtered_fastq ../casework_folder/processed_data/metagenomic/kraken2 ../casework_folder/processed_data/metagenomic/classified ../casework_folder/processed_data/metagenomic/unclassified ../casework_folder/processed_data/metagenomic/bracken ../casework_folder/results/runs/run_3004_1602/reports ../casework_folder/results/runs/run_3004_1602/krona ../casework_folder/results/runs/run_3004_1602/diversity ../casework_folder/results/runs/run_3004_1602/logs ../casework_folder/processed_data/human/sorted_bam ../casework_folder/processed_data/human/bed_files
+ tree -L 3 -d ../casework_folder
+ echo 'Human DNA-related files (SAM, BAM, and BED) in the '\''human'\'' directory are created once per sub-project and remain unchanged across runs.'
+ echo 'Intermediate metagenomic files in the '\''metagenomic'\'' directory are overwritten with each run and should be inspected beforehand if desired.'
+ echo 'Results are stored in the '\''results'\'' directory (including FastQC, host DNA analysis, and run-specific results like Kraken2 and Bracken).'
+ [[ true == true ]]
+ echo -e '\n=================================================== QUALITY CONTROL & TRIMMING ===================================================\n'
+ ../scripts/helper_scripts/qc_trim.sh ../casework_folder/raw_data/
Started analysis of Heart_S16_L001_R1_001.fastq.gz
Approx 5% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 10% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 15% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 20% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 25% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 30% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 35% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 40% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 45% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 50% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 55% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 60% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 65% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 70% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 75% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 80% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 85% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 90% complete for Heart_S16_L001_R1_001.fastq.gz
Approx 95% complete for Heart_S16_L001_R1_001.fastq.gz
Started analysis of Heart_S16_L001_R2_001.fastq.gz
Approx 5% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 10% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 15% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 20% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 25% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 30% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 35% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 40% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 45% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 50% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 55% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 60% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 65% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 70% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 75% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 80% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 85% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 90% complete for Heart_S16_L001_R2_001.fastq.gz
Approx 95% complete for Heart_S16_L001_R2_001.fastq.gz
+ echo -e '✅ QC and trimming completed successfully.'
+ echo -e '\n================================================= METAGENOMIC ABUNDANCE ESTIMATION ================================================='
+ echo '⚠️ This step assumes reads have already been trimmed with Trimmomatic and host DNA removed with Bowtie2. Processed reads must be in the correct directory.'
++ date +%s
+ START_TIME=1746025363
+ for R1 in "$TRIMMED_DIR"/paired/*_R1_paired.fastq.gz
++ basename ../casework_folder/processed_data/trimmed/paired/Heart_S16_R1_paired.fastq.gz _R1_paired.fastq.gz
+ base=Heart_S16
+ echo -e '\nProcessing sample: Heart_S16'
+ [[ true == true ]]
+ echo -e '\nRemoving human reads with Bowtie2...'
+ BOWTIE_CMD='bowtie2 -x "../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as" -p 8 -q --end-to-end --very-sensitive --no-mixed --no-discordant 	-1 "../casework_folder/processed_data/trimmed/paired/Heart_S16_R1_paired.fastq.gz" -2 "../casework_folder/processed_data/trimmed/paired/Heart_S16_R2_paired.fastq.gz" 	--un-conc "../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic" -S "../casework_folder/processed_data/human/aligned_sam/Heart_S16_human.sam" 2>&1'
+ echo 'bowtie2 -x "../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as" -p 8 -q --end-to-end --very-sensitive --no-mixed --no-discordant 	-1 "../casework_folder/processed_data/trimmed/paired/Heart_S16_R1_paired.fastq.gz" -2 "../casework_folder/processed_data/trimmed/paired/Heart_S16_R2_paired.fastq.gz" 	--un-conc "../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic" -S "../casework_folder/processed_data/human/aligned_sam/Heart_S16_human.sam" 2>&1'
+ eval bowtie2 -x '"../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as"' -p 8 -q --end-to-end --very-sensitive --no-mixed --no-discordant -1 '"../casework_folder/processed_data/trimmed/paired/Heart_S16_R1_paired.fastq.gz"' -2 '"../casework_folder/processed_data/trimmed/paired/Heart_S16_R2_paired.fastq.gz"' --un-conc '"../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic"' -S '"../casework_folder/processed_data/human/aligned_sam/Heart_S16_human.sam"' '2>&1'
++ bowtie2 -x ../data/bowtie_index/GRCh38_noalt_as/GRCh38_noalt_as -p 8 -q --end-to-end --very-sensitive --no-mixed --no-discordant -1 ../casework_folder/processed_data/trimmed/paired/Heart_S16_R1_paired.fastq.gz -2 ../casework_folder/processed_data/trimmed/paired/Heart_S16_R2_paired.fastq.gz --un-conc ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic -S ../casework_folder/processed_data/human/aligned_sam/Heart_S16_human.sam
+ for i in 1 2
+ gzip -f ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1
+ for i in 1 2
+ gzip -f ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2
+ echo '✅ Host reads removed and filtered reads compressed.'
+ echo -e '\nClassifying metagenomic reads with Kraken2...'
+ KRAKEN_CMD='kraken2 --db "../data/databases/k2_standard_16gb_20241228" --threads 8 --report "../casework_folder/results/runs/run_3004_1602/reports/Heart_S16.k2report"                --report-minimizer-data --paired --minimum-hit-groups 2 --gzip-compressed                --classified-out "../casework_folder/processed_data/metagenomic/classified/Heart_S16_classified#.fastq" --unclassified-out "../casework_folder/processed_data/metagenomic/unclassified/Heart_S16_unclassified#.fastq"                "../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.gz" "../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.gz"                --output "../casework_folder/processed_data/metagenomic/kraken2/Heart_S16.kraken2" --use-names 2>&1'
+ echo 'kraken2 --db "../data/databases/k2_standard_16gb_20241228" --threads 8 --report "../casework_folder/results/runs/run_3004_1602/reports/Heart_S16.k2report"                --report-minimizer-data --paired --minimum-hit-groups 2 --gzip-compressed                --classified-out "../casework_folder/processed_data/metagenomic/classified/Heart_S16_classified#.fastq" --unclassified-out "../casework_folder/processed_data/metagenomic/unclassified/Heart_S16_unclassified#.fastq"                "../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.gz" "../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.gz"                --output "../casework_folder/processed_data/metagenomic/kraken2/Heart_S16.kraken2" --use-names 2>&1'
+ eval kraken2 --db '"../data/databases/k2_standard_16gb_20241228"' --threads 8 --report '"../casework_folder/results/runs/run_3004_1602/reports/Heart_S16.k2report"' --report-minimizer-data --paired --minimum-hit-groups 2 --gzip-compressed --classified-out '"../casework_folder/processed_data/metagenomic/classified/Heart_S16_classified#.fastq"' --unclassified-out '"../casework_folder/processed_data/metagenomic/unclassified/Heart_S16_unclassified#.fastq"' '"../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.gz"' '"../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.gz"' --output '"../casework_folder/processed_data/metagenomic/kraken2/Heart_S16.kraken2"' --use-names '2>&1'
++ kraken2 --db ../data/databases/k2_standard_16gb_20241228 --threads 8 --report ../casework_folder/results/runs/run_3004_1602/reports/Heart_S16.k2report --report-minimizer-data --paired --minimum-hit-groups 2 --gzip-compressed --classified-out ../casework_folder/processed_data/metagenomic/classified/Heart_S16_classified#.fastq --unclassified-out ../casework_folder/processed_data/metagenomic/unclassified/Heart_S16_unclassified#.fastq ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.gz ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.gz --output ../casework_folder/processed_data/metagenomic/kraken2/Heart_S16.kraken2 --use-names
+ echo '✅ Classification complete.'
+ echo -e '\nEstimating species abundance with Bracken...'
+ bracken -d ../data/databases/k2_standard_16gb_20241228 -i ../casework_folder/results/runs/run_3004_1602/reports/Heart_S16.k2report -l S -r 100 -t 10 -w ../casework_folder/results/runs/run_3004_1602/reports/Heart_S16.breport -o ../casework_folder/processed_data/metagenomic/bracken/Heart_S16.bracken
+ echo '✅ Abundance estimated.'
+ echo -e '\nGenerating Krona visualization...'
+ python ../tools/KrakenTools/kreport2krona.py -r ../casework_folder/results/runs/run_3004_1602/reports/Heart_S16.breport -o ../casework_folder/results/runs/run_3004_1602/krona/Heart_S16.krona.txt --no-intermediate-ranks
+ ../tools/Krona/KronaTools/scripts/ImportText.pl ../casework_folder/results/runs/run_3004_1602/krona/Heart_S16.krona.txt -o ../casework_folder/results/runs/run_3004_1602/krona/Heart_S16.krona.html
+ rm ../casework_folder/results/runs/run_3004_1602/krona/Heart_S16.krona.txt
+ echo '✅ Krona plot generated.'
+ for gz_file in "$FILTERED_FASTQ_DIR"/*.gz
++ basename ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.gz .gz
+ base_name=Heart_S16_metagenomic.1
+ new_name=../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.fastq
+ [[ -f ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.gz ]]
+ echo 'Unzipping: ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.gz -> ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.fastq'
+ gunzip -c ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.1.gz
+ for gz_file in "$FILTERED_FASTQ_DIR"/*.gz
++ basename ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.gz .gz
+ base_name=Heart_S16_metagenomic.2
+ new_name=../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.fastq
+ [[ -f ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.gz ]]
+ echo 'Unzipping: ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.gz -> ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.fastq'
+ gunzip -c ../casework_folder/processed_data/metagenomic/filtered_fastq/Heart_S16_metagenomic.2.gz
+ ../scripts/helper_scripts/get_fastq_stats.sh ../casework_folder/processed_data/metagenomic/filtered_fastq
+ ../scripts/helper_scripts/get_fastq_stats.sh ../casework_folder/processed_data/metagenomic/classified
+ ../scripts/helper_scripts/get_fastq_stats.sh ../casework_folder/processed_data/metagenomic/unclassified
++ date +%s
+ END_TIME=1746025432
+ DURATION=69
+ printf -v FORMATTED_DURATION %02d:%02d:%02d 0 1 9
+ echo -e '\nMetagenomic classification completed in: 00:01:09'
+ echo -e '\n================================================= COMPARISON TO GROUND TRUTH ================================================='
+ echo -e '\nCombining Bracken reports...'
+ Rscript ../scripts/helper_scripts/combine_breports.R ../casework_folder/results/runs/run_3004_1602/reports/Heart_S16.breport
Error in library(tidyverse) : there is no package called ‘tidyverse’
Execution halted
