### README â€“ Metagenomic Analysis Pipeline  

This repository contains scripts for processing, analyzing, and visualizing metagenomic sequencing data. The pipeline includes human read removal, taxonomic classification, diversity analysis, phylogenetic tree construction, and genomic region visualization.

#### `refinement_pipeline.sh`  
This Bash script processes metagenomic samples by removing human reads with `bowtie2`, classifying microbial reads with `kraken2`, estimating microbial abundance with `bracken`, and generating visualizations using `KronaTools`. It also computes alpha and beta diversity with `KrakenTools`, generates a beta diversity heatmap (`b_diversity_heatmap.R`), and summarizes human read alignments with `human_alignment.sh`.  

#### `b_diversity_heatmap.R`  
This R script processes a beta diversity matrix generated by `beta_diversity.py` (KrakenTools). It extracts metadata, converts the data into a numeric matrix, and generates a heatmap to visualize pairwise beta diversity relationships.  

#### `human_alignment.sh`  
This Bash script processes Bowtie2 alignments to analyze human reads in metagenomic samples. It converts SAM to BAM and BED with `samtools` and `bedtools`, computes Jaccard similarity with `bedtools jaccard`, generates a heatmap with `jaccard_similarity_heatmap.R`, and identifies common genomic regions with `bedtools multiinter`.  

#### `jaccard_similarity_heatmap.R`  
This R script processes a Jaccard similarity matrix from BED file comparisons using `bedtools jaccard`. It constructs a symmetric matrix and generates a heatmap to visualize pairwise similarity relationships between genomic regions.  

#### `karyotype.R`  
This R script generates a karyotype plot visualizing genomic region frequencies across the human genome for multiple samples using `karyoploteR`. It processes a BED file (`common_intersections.bed`), converts genomic regions into a GRanges object, and saves the plot as `karyotype_frequency.jpg`.  

#### `human_aligned_tree.R`  
This R script constructs a phylogenetic tree from BLAST results by retrieving taxonomic classifications for aligned sequences. It processes a BLAST output file (`combined_blast_results.txt`), extracts unique taxonomic IDs, fetches NCBI taxonomy data, and generates a phylogenetic tree using `ggtree`. Highlighted species are labeled in red, and the final tree is saved as `combined_blast_tree.png`.  

#### `phylo_classification_comparison.R`  
This R script compares taxonomic classifications across samples by integrating phylogenetic analysis and abundance heatmaps. It processes a comparison table (`pavian/comparison_table.tsv`), retrieves taxonomic classifications via NCBI, constructs a phylogenetic tree, and generates species, genus, and phylum-level heatmaps to show deviations from expected microbial abundances. The final visualization combines the phylogenetic tree and abundance heatmaps into `phylo_classification_comparison.png`.  

Note: `human_aligned_tree.R` and `phylo_classification_comparison.R` must be run locally to generate graphics because `ggree` is not available on the HPC.  

